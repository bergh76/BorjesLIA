@model BorjesLIA.ViewModel.DieselQuarterViewModel

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

@{ var dieselQuarterChartList = Model.settings.Select(x => x.ChartType).Distinct().ToList();
    var chartID = dieselQuarterChartList.FirstOrDefault();
    if (chartID == 1)
    {
        <script type="text/javascript">
            google.load("visualization", "1", { packages: ["corechart"] });
            google.setOnLoadCallback(drawchart);
            function drawchart() {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    // Calls an Action from Controller ie. EuroExhangeModelsController/GetData
                    url: '@Url.Action("GetData")',
                    data: "{ }",
                    // If data connections is success
                    success:
                        function drawchart(dataValues) {
                            // Adds data into columns to DataTable
                            var data = new google.visualization.DataTable();
                            data.addColumn('string', 'Datum');
                            data.addColumn('number', 'Pris');
                            if (window.JSON && !window.JSON.dateParser) {
                                var reISO = /^(\y{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;
                                var reMsAjax = /^\/Date\((d|-|.*)\)[\/|\\]$/;

                                JSON.dateParser = function (key, value) {
                                    if (typeof value === 'string') {
                                        var a = reISO.exec(value);
                                        if (a)
                                            return new Date(value);
                                        a = reMsAjax.exec(value);
                                        if (a) {
                                            var b = a[1].split(/[-+,.]/);
                                            return new Date(b[0] ? +b[0] : 0 - +b[1]);
                                        }
                                    }
                                    return value;
                                };

                            }
                            // Loops through the DataTable with data from database
                            for (var i = 0; i < dataValues.length; i++) {
                                var str = window.JSON.stringify(dataValues[i].Date);
                                //console.log("Här var det strängat",str);
                                var date = JSON.parse(str, JSON.dateParser);
                                //console.log("Här ska det vara datum", date);
                                data.addRow([
                                    //(dataValues[i].Date), dataValues[i].euroValue])
                                    (new Date(date).toDateString()), dataValues[i].DieselQuarterValue])
                                console.log(data);

                            }
                            var view = new google.visualization.DataView(data);
                            view.setColumns([0, 1,
                                             {
                                                 calc: "stringify",
                                                 sourceColumn: 1,
                                                 type: "string",
                                                 role: "annotation",
                                             },
                            ]);
                            // Settings for visualization of the graph
                            var options = {
                                chartArea:{left:45,top:20,width:"100%",height:"80%"},
                                title: 'Dieselpris per kvartal',
                                width: '100%',
                                height: '100%',
                                pointSize: 3,
                                dataOpacity: 0.4,
                                lineWidth: 2,
                                hAxis: {
                                    title: 'Datum', titleTextStyle: { color: '#333' },
                                }
                            }

                            // Draws the graph into a specified div
                            var chart = new google.visualization.LineChart(document.getElementById("DieselquarterDiv"));
                            chart.draw(view, options);
                        },
                    // If collectning data from database fails promp message here
                    error: function () { alert("Ett fel uppstod när datat försökte hämtas!"); }
                });
            }
        </script>
    }
    if (chartID == 2)
    {
        <script type="text/javascript">
            google.load("visualization", "1", { packages: ["corechart"] });
            google.setOnLoadCallback(drawchart);
            function drawchart() {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    // Calls an Action from Controller ie. EuroExhangeModelsController/GetData
                    url: '@Url.Action("GetData")',
                    data: "{ }",
                    // If data connections is success
                    success:
                        function drawchart(dataValues) {
                            // Adds data into columns to DataTable
                            var data = new google.visualization.DataTable();
                            data.addColumn('string', 'Datum');
                            data.addColumn('number', 'Pris');
                            if (window.JSON && !window.JSON.dateParser) {
                                var reISO = /^(\y{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;
                                var reMsAjax = /^\/Date\((d|-|.*)\)[\/|\\]$/;

                                JSON.dateParser = function (key, value) {
                                    if (typeof value === 'string') {
                                        var a = reISO.exec(value);
                                        if (a)
                                            return new Date(value);
                                        a = reMsAjax.exec(value);
                                        if (a) {
                                            var b = a[1].split(/[-+,.]/);
                                            return new Date(b[0] ? +b[0] : 0 - +b[1]);
                                        }
                                    }
                                    return value;
                                };

                            }
                            // Loops through the DataTable with data from database
                            for (var i = 0; i < dataValues.length; i++) {
                                var str = window.JSON.stringify(dataValues[i].Date);
                                //console.log("Här var det strängat",str);
                                var date = JSON.parse(str, JSON.dateParser);
                                //console.log("Här ska det vara datum", date);
                                data.addRow([
                                    //(dataValues[i].Date), dataValues[i].euroValue])
                                    (new Date(date).toDateString()), dataValues[i].DieselQuarterValue])
                                console.log(data);

                            }
                            var view = new google.visualization.DataView(data);
                            view.setColumns([0, 1,
                                             {
                                                 calc: "stringify",
                                                 sourceColumn: 1,
                                                 type: "string",
                                                 role: "annotation",
                                             },
                            ]);

                            // Settings for visualization of the graph
                            var options = {
                                chartArea: { left: 45, top: 20, width: "100%", height: "80%" },
                                title: 'Dieselpris per kvartal',
                                width: '100%',
                                height: '100%',
                                pointSize: 3,
                                dataOpacity: 0.4,
                                ineWidth: 2,
                                hAxis: {
                                    title: 'Datum', titleTextStyle: { color: '#333' },
                                }
                            }
                            // Draws the graph into a specified div
                            var chart = new google.visualization.BarChart(document.getElementById("DieselquarterDiv"));
                            chart.draw(view, options);
                        },
                    // If collectning data from database fails promp message here
                    error: function () { alert("Ett fel uppstod när datat försökte hämtas!"); }
                });
            }
        </script>
    }
    if (chartID == 3)
    {
        <script type="text/javascript">
            google.load("visualization", "1", { packages: ["corechart"] });
            google.setOnLoadCallback(drawchart);
            function drawchart() {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    // Calls an Action from Controller ie. EuroExhangeModelsController/GetData
                    url: '@Url.Action("GetData")',
                    data: "{ }",
                    // If data connections is success
                    success:
                        function drawchart(dataValues) {
                            // Adds data into columns to DataTable
                            var data = new google.visualization.DataTable();
                            data.addColumn('string', 'Datum');
                            data.addColumn('number', 'Pris');
                            if (window.JSON && !window.JSON.dateParser) {
                                var reISO = /^(\y{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;
                                var reMsAjax = /^\/Date\((d|-|.*)\)[\/|\\]$/;

                                JSON.dateParser = function (key, value) {
                                    if (typeof value === 'string') {
                                        var a = reISO.exec(value);
                                        if (a)
                                            return new Date(value);
                                        a = reMsAjax.exec(value);
                                        if (a) {
                                            var b = a[1].split(/[-+,.]/);
                                            return new Date(b[0] ? +b[0] : 0 - +b[1]);
                                        }
                                    }
                                    return value;
                                };

                            }
                            // Loops through the DataTable with data from database
                            for (var i = 0; i < dataValues.length; i++) {
                                var str = window.JSON.stringify(dataValues[i].Date);
                                //console.log("Här var det strängat",str);
                                var date = JSON.parse(str, JSON.dateParser);
                                //console.log("Här ska det vara datum", date);
                                data.addRow([
                                    //(dataValues[i].Date), dataValues[i].euroValue])
                                    (new Date(date).toDateString()), dataValues[i].DieselQuarterValue])
                                console.log(data);

                            }
                            var view = new google.visualization.DataView(data);
                            view.setColumns([0, 1,
                                             {
                                                 calc: "stringify",
                                                 sourceColumn: 1,
                                                 type: "string",
                                                 role: "annotation",
                                             },
                            ]);

                            // Settings for visualization of the graph
                            var options = {
                                chartArea: { left: 45, top: 20, width: "100%", height: "80%" },
                                title: 'Dieselpris per kvartal',
                                width: '100%',
                                height: '100%',
                                pointSize: 3,
                                dataOpacity: 0.4,
                                lineWidth: 2,
                                hAxis: {
                                    title: 'Datum', titleTextStyle: { color: '#333' },
                                }
                            }

                            // Draws the graph into a specified div
                            var chart = new google.visualization.ColumnChart(document.getElementById("DieselquarterDiv"));
                            chart.draw(view, options);
                        },
                    // If collectning data from database fails promp message here
                    error: function () { alert("Ett fel uppstod när datat försökte hämtas!"); }
                });
            }
        </script>
    }
    if (chartID == 4)
    {
        <script type="text/javascript">
            google.load("visualization", "1", { packages: ["corechart"] });
            google.setOnLoadCallback(drawchart);
            function drawchart() {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    // Calls an Action from Controller ie. EuroExhangeModelsController/GetData
                    @*url: '@Url.Action("GetComboData")',*@
                    url: '@Url.Action("GetData")',
                    data: "{ }",
                    // If data connections is success
                    success:
                        function drawchart(dataValues) {
                            var data = google.visualization.arrayToDataTable([
                                    ['År', 'Kvartal', 'Pris'],
                                   // ['Kvartal','År','Pris']
                            ]);
                            //var data = new google.visualization.DataTable();
                            //data.addColumn('string', 'År');
                            //data.addColumn('string', 'Kvartal'); 
                            //data.addColumn('number', 'Pris');
                            console.log("DataArray:", data);
                            
                            if (window.JSON && !window.JSON.dateParser) {
                                var reISO = /^(\y{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*))(?:Z|(\+|-)([\d|:]*))?$/;
                                var reMsAjax = /^\/Date\((d|-|.*)\)[\/|\\]$/;

                                JSON.dateParser = function (key, value) {
                                    if (typeof value === 'string') {
                                        var a = reISO.exec(value);
                                        if (a)
                                            return new Date(value);
                                        a = reMsAjax.exec(value);
                                        if (a) {
                                            var b = a[1].split(/[-+,.]/);
                                            return new Date(b[0] ? +b[0] : 0 - +b[1]);
                                        }
                                    }
                                    return value;
                                };

                            }
                             //Loops through the DataTable with data from database
                            for (var i = 0; i < dataValues.length; i++) {
                                
                            //    console.log("DataValues innan addRow:", dataValues);
                                var str = dataValues[i].DieselQuarterValue;                                
                            //    //console.log("Här var det strängat", str);
                                var numVal = parseFloat(str);
                               //console.log("Här ska det vara numval", numVal);
                            ////    //var date = JSON.parse(str, JSON.dateParser);
                            ////    //console.log("Här ska det vara datum", date);
                                data.addRow([dataValues[i].Year.toString(), dataValues[i].Quarter.toString(), dataValues[i].DieselQuarterValue.toString()])
                                console.log("Data efter iSnurra:", data);
                            }
                            
                            var view = new google.visualization.DataView(data);
                            view.setColumns([0,
                                             {
                                                 calc: "stringify",
                                                 sourceColumn: 2,
                                                 type: "string",
                                                 role: "annotation",
                                             },
                            ]);

                            // Settings for visualization of the graph
                            var options = {
                                chartArea: { left: 45, top: 20, width: "100%", height: "80%" },
                                seriesType: 'bars',
                                series:
                                    {
                                        3: {type: 'column'}
                                    },
                                title: 'Dieselpris per kvartal Kombo',
                                //width: '100%',
                                //height: '100%',
                                pointSize: 3,
                                dataOpacity: 0.4,
                                lineWidth: 2,
                                hAxis: {
                                    title: 'Datum', titleTextStyle: { color: '#333' },
                                }
                            }
                            // Draws the graph into a specified div
                            var chart = new google.visualization.ComboChart(document.getElementById("DieselquarterDiv"));
                            chart.draw(view, options);
                        },
                    // If collectning data from database fails promp message here
                    error: function () { alert("Ett fel uppstod när datat försökte hämtas!"); }
                });
            }
        </script>
    }
}

<div class="x_panel">
    <div class="x_content">
        <div id="DieselquarterDiv" style="width: 100%; height:650px"></div>
    </div>
</div>